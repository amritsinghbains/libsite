<html>
<head>
<title>views.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(0,0,128); font-weight: bold; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(0,0,0); }
.s3 { color: rgb(128,128,128); font-style: italic; }
.s4 { color: rgb(0,128,128); font-weight: bold; }
.s5 { color: rgb(0,0,255); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
views.py</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">urlresolvers </span><span class="s0">import </span><span class="s1">reverse 
</span><span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">shortcuts </span><span class="s0">import </span><span class="s1">render 
</span><span class="s3"># Create your views here.</span><span class="s1"> 
</span><span class="s3"># Import necessary classes</span><span class="s1"> 
</span><span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">http </span><span class="s0">import </span><span class="s1">HttpResponse 
</span><span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">serializers 
</span><span class="s0">from </span><span class="s1">libapp</span><span class="s2">.</span><span class="s1">forms </span><span class="s0">import </span><span class="s1">SuggestionForm, SearchlibForm, LoginForm, LibuserForm 
</span><span class="s0">from </span><span class="s1">libapp</span><span class="s2">.</span><span class="s1">models </span><span class="s0">import </span><span class="s1">Book, Dvd, Libuser, Libitem, Suggestion 
</span><span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">shortcuts </span><span class="s0">import </span><span class="s1">get_object_or_404 
</span><span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">http </span><span class="s0">import </span><span class="s1">HttpResponseRedirect 
</span><span class="s0">import </span><span class="s1">operator 
 
</span><span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">contrib</span><span class="s2">.</span><span class="s1">auth </span><span class="s0">import </span><span class="s1">authenticate, login, logout 
</span><span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">contrib</span><span class="s2">.</span><span class="s1">auth</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">login_required, user_passes_test 
 
</span><span class="s3"># Create your viewsx     here.</span><span class="s1"> 
</span><span class="s0">def </span><span class="s1">searchlib</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    </span><span class="s0">if </span><span class="s1">request</span><span class="s2">.</span><span class="s1">method == </span><span class="s4">'POST'</span><span class="s1">: 
        SearchlibForm</span><span class="s2">(</span><span class="s1">request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">)</span><span class="s1"> 
        title1 = request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'title'</span><span class="s2">]</span><span class="s1"> 
        author1 = request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'author'</span><span class="s2">]</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">title1 != </span><span class="s4">'' </span><span class="s0">and </span><span class="s1">author1 != </span><span class="s4">''</span><span class="s1">:  </span><span class="s3"># Title and User not null</span><span class="s1"> 
            bookob = Book</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">title__contains=title1, author__contains=author1</span><span class="s2">)</span><span class="s1"> 
            dvdob = Dvd</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">title__contains=title1, maker__contains=author1</span><span class="s2">)</span><span class="s1"> 
            form = SearchlibForm</span><span class="s2">()</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">bookob </span><span class="s0">and </span><span class="s1">dvdob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'bookob'</span><span class="s1">: bookob, </span><span class="s4">'dvdob'</span><span class="s1">: dvdob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">elif not </span><span class="s1">bookob </span><span class="s0">and </span><span class="s1">dvdob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'dvdob'</span><span class="s1">: dvdob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">elif </span><span class="s1">bookob </span><span class="s0">and not </span><span class="s1">dvdob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'bookob'</span><span class="s1">: bookob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'notfound'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
 
        </span><span class="s0">elif </span><span class="s1">title1 != </span><span class="s4">'' </span><span class="s0">and </span><span class="s1">author1 == </span><span class="s4">''</span><span class="s1">:  </span><span class="s3"># Only Title searched</span><span class="s1"> 
            bookob = Book</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">title__contains=title1</span><span class="s2">)</span><span class="s1"> 
            dvdob = Dvd</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">title__contains=title1</span><span class="s2">)</span><span class="s1"> 
            form = SearchlibForm</span><span class="s2">()</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">bookob </span><span class="s0">and </span><span class="s1">dvdob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'bookob'</span><span class="s1">: bookob, </span><span class="s4">'dvdob'</span><span class="s1">: dvdob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">elif </span><span class="s1">bookob </span><span class="s0">and not </span><span class="s1">dvdob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'bookob'</span><span class="s1">: bookob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">elif not </span><span class="s1">bookob </span><span class="s0">and </span><span class="s1">dvdob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'dvdob'</span><span class="s1">: dvdob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'notfound'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
 
        </span><span class="s0">elif </span><span class="s1">author1 != </span><span class="s4">'' </span><span class="s0">and </span><span class="s1">title1 == </span><span class="s4">''</span><span class="s1">:  </span><span class="s3"># Only Author searched</span><span class="s1"> 
            bookob = Book</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">author__contains=author1</span><span class="s2">)</span><span class="s1"> 
            dvdob = Dvd</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">maker__contains=author1</span><span class="s2">)</span><span class="s1"> 
            form = SearchlibForm</span><span class="s2">()</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">bookob </span><span class="s0">and </span><span class="s1">dvdob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'bookob'</span><span class="s1">: bookob, </span><span class="s4">'dvdob'</span><span class="s1">: dvdob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">elif </span><span class="s1">bookob </span><span class="s0">and not </span><span class="s1">dvdob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'bookob'</span><span class="s1">: bookob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">elif not </span><span class="s1">dvdob </span><span class="s0">and </span><span class="s1">bookob: 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'dvdob'</span><span class="s1">: dvdob, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                form = SearchlibForm</span><span class="s2">()</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'notfound'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
 
        </span><span class="s0">else</span><span class="s1">:  </span><span class="s3"># Author and Title null</span><span class="s1"> 
            form = SearchlibForm</span><span class="s2">()</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'notinput'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
 
    </span><span class="s0">else</span><span class="s1">: 
        form = SearchlibForm</span><span class="s2">()</span><span class="s1"> 
        </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/searchitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
 
 
 
 
 
</span><span class="s0">def </span><span class="s1">newitem1</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    </span><span class="s0">return  </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request,</span><span class="s4">'libapp/newitem.html'</span><span class="s2">)</span><span class="s1"> 
 
</span><span class="s0">def </span><span class="s1">suggestions</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    suggestionlist = Suggestion</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">all</span><span class="s2">()[</span><span class="s1">:</span><span class="s5">10</span><span class="s2">]</span><span class="s1"> 
    </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/suggestions.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'itemlist'</span><span class="s1">:   suggestionlist</span><span class="s2">})</span><span class="s1"> 
 
 
</span><span class="s0">def </span><span class="s1">detail</span><span class="s2">(</span><span class="s1">request,item_id</span><span class="s2">)</span><span class="s1">: 
    item = Libitem</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">pk=item_id</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">if </span><span class="s1">item</span><span class="s2">.</span><span class="s1">itemtype == </span><span class="s4">'Book'</span><span class="s1">: 
        item = Book</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">pk=item_id</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">else</span><span class="s1">: 
        item = Dvd</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">pk=item_id</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/detail.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'item'</span><span class="s1">: item</span><span class="s2">})</span><span class="s1"> 
 
</span><span class="s0">def </span><span class="s1">suggestiondetail</span><span class="s2">(</span><span class="s1">request,item_id</span><span class="s2">)</span><span class="s1">: 
    item = Suggestion</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">pk=item_id</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/suggestiondetail.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'item'</span><span class="s1">: item</span><span class="s2">})</span><span class="s1"> 
 
</span><span class="s0">def </span><span class="s1">detail1</span><span class="s2">(</span><span class="s1">request, item_id</span><span class="s2">)</span><span class="s1">: 
    response = HttpResponse</span><span class="s2">()</span><span class="s1"> 
    type=</span><span class="s4">'Book'</span><span class="s1"> 
    </span><span class="s0">try</span><span class="s1">: 
        item = Book</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">pk=item_id</span><span class="s2">)</span><span class="s1"> 
        para3 = </span><span class="s4">'&lt;p&gt;Author: ' </span><span class="s1">+ str</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">author</span><span class="s2">) </span><span class="s1">+ </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
    </span><span class="s0">except </span><span class="s1">Book</span><span class="s2">.</span><span class="s1">DoesNotExist:  </span><span class="s3"># catch the DoesNotExist error</span><span class="s1"> 
        </span><span class="s3"># item = Dvd.objects.get(pk=item_id)</span><span class="s1"> 
        item = get_object_or_404</span><span class="s2">(</span><span class="s1">Dvd, pk=item_id</span><span class="s2">)</span><span class="s1"> 
        type = </span><span class="s4">'Dvd'</span><span class="s1"> 
        para3 = </span><span class="s4">'&lt;p&gt;Maker: ' </span><span class="s1">+ str</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">maker</span><span class="s2">) </span><span class="s1">+ </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
 
    para = </span><span class="s4">'&lt;p&gt;This is a ' </span><span class="s1">+ type + </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
    para1 = </span><span class="s4">'&lt;p&gt;Title: ' </span><span class="s1">+ item</span><span class="s2">.</span><span class="s1">title + </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
    para2 = </span><span class="s4">'&lt;p&gt;Due Date: ' </span><span class="s1">+ str</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">duedate</span><span class="s2">) </span><span class="s1">+ </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
    response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">para</span><span class="s2">)</span><span class="s1"> 
    response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">para1</span><span class="s2">)</span><span class="s1"> 
    response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">para2</span><span class="s2">)</span><span class="s1"> 
    response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">para3</span><span class="s2">)</span><span class="s1"> 
 
    </span><span class="s0">return </span><span class="s1">response 
 
</span><span class="s0">def </span><span class="s1">index</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    itemlist = Libitem</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">all</span><span class="s2">().</span><span class="s1">order_by</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">)[</span><span class="s1">:</span><span class="s5">10</span><span class="s2">]</span><span class="s1"> 
    </span><span class="s0">try</span><span class="s1">: 
        request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'luckynum'</span><span class="s2">]</span><span class="s1"> 
        request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'model_pic'</span><span class="s2">]</span><span class="s1"> 
    </span><span class="s0">except </span><span class="s1">KeyError: 
        request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'luckynum'</span><span class="s2">] </span><span class="s1">= </span><span class="s5">0</span><span class="s1">; 
        request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'model_pic'</span><span class="s2">] </span><span class="s1">= </span><span class="s5">0</span><span class="s1">; 
    </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/index.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'itemlist'</span><span class="s1">: itemlist, </span><span class="s4">'luckynum'</span><span class="s1">: request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'luckynum'</span><span class="s2">]</span><span class="s1">, </span><span class="s4">'model_pic' </span><span class="s1">:request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'model_pic'</span><span class="s2">]})</span><span class="s1"> 
 
 
</span><span class="s0">def </span><span class="s1">index1</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    booklist = Book</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">all</span><span class="s2">() [</span><span class="s1">:</span><span class="s5">10</span><span class="s2">]</span><span class="s1"> 
    response = HttpResponse</span><span class="s2">()</span><span class="s1"> 
    heading1 = </span><span class="s4">'&lt;p&gt;' </span><span class="s1">+ </span><span class="s4">'List of books: ' </span><span class="s1">+ </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
    response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">heading1</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">for </span><span class="s1">book </span><span class="s0">in </span><span class="s1">booklist: 
        para = </span><span class="s4">'&lt;p&gt;' </span><span class="s1">+ str</span><span class="s2">(</span><span class="s1">book</span><span class="s2">) </span><span class="s1">+ </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
        response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">para</span><span class="s2">)</span><span class="s1"> 
 
    dvdlist = Dvd</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">all</span><span class="s2">().</span><span class="s1">order_by</span><span class="s2">(</span><span class="s4">'pubyr'</span><span class="s2">) [</span><span class="s1">:</span><span class="s5">5</span><span class="s2">]</span><span class="s1"> 
    heading2 = </span><span class="s4">'&lt;p&gt;' </span><span class="s1">+ </span><span class="s4">'List of dvds: ' </span><span class="s1">+ </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
    response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">heading2</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">for </span><span class="s1">dvd </span><span class="s0">in </span><span class="s1">dvdlist: 
        para1 = </span><span class="s4">'&lt;p&gt;' </span><span class="s1">+ str</span><span class="s2">(</span><span class="s1">dvd</span><span class="s2">) </span><span class="s1">+ </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
        response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">para1</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">return </span><span class="s1">response 
 
</span><span class="s0">def </span><span class="s1">home</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/home.html'</span><span class="s1">, </span><span class="s2">{})</span><span class="s1"> 
 
</span><span class="s0">def </span><span class="s1">about</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    </span><span class="s0">try</span><span class="s1">: 
        request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'about_visits'</span><span class="s2">] </span><span class="s1">+= </span><span class="s5">1</span><span class="s1"> 
    </span><span class="s0">except </span><span class="s1">KeyError: 
        request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">.</span><span class="s1">set_expiry</span><span class="s2">(</span><span class="s5">300</span><span class="s2">)</span><span class="s1"> 
        request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'about_visits'</span><span class="s2">] </span><span class="s1">= </span><span class="s5">0</span><span class="s1">; 
    </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/about.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'about_visits'</span><span class="s1">: request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'about_visits'</span><span class="s2">]})</span><span class="s1"> 
 
</span><span class="s0">def </span><span class="s1">about1</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    response =  HttpResponse</span><span class="s2">()</span><span class="s1"> 
    heading1 = </span><span class="s4">'&lt;p&gt;' </span><span class="s1">+ </span><span class="s4">'This is a Library APP.' </span><span class="s1">+ </span><span class="s4">'&lt;/p&gt;'</span><span class="s1"> 
    response</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s1">heading1</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">return </span><span class="s1">response 
 
</span><span class="s0">import </span><span class="s1">random 
 
</span><span class="s0">def </span><span class="s1">user_login</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    form = LoginForm</span><span class="s2">()</span><span class="s1"> 
    </span><span class="s0">if </span><span class="s1">request</span><span class="s2">.</span><span class="s1">method == </span><span class="s4">'POST'</span><span class="s1">: 
        username = request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'username'</span><span class="s2">]</span><span class="s1"> 
        password = request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'password'</span><span class="s2">]</span><span class="s1"> 
        user = authenticate</span><span class="s2">(</span><span class="s1">username=username, password=password</span><span class="s2">)</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">user </span><span class="s0">is not None and </span><span class="s1">user</span><span class="s2">.</span><span class="s1">is_active: 
            request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">.</span><span class="s1">set_expiry</span><span class="s2">(</span><span class="s5">3600</span><span class="s2">)</span><span class="s1"> 
            n = random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s5">1</span><span class="s1">, </span><span class="s5">9</span><span class="s2">)</span><span class="s1"> 
            request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'luckynum'</span><span class="s2">] </span><span class="s1">= n; 
            login</span><span class="s2">(</span><span class="s1">request, user</span><span class="s2">)</span><span class="s1"> 
            userob = Libuser</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">username=request</span><span class="s2">.</span><span class="s1">user</span><span class="s2">.</span><span class="s1">username</span><span class="s2">)</span><span class="s1"> 
            value = </span><span class="s4">'pic_folder/download.jpg'</span><span class="s1"> 
            </span><span class="s3"># if userob.length &gt; 0:</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">userob: 
                </span><span class="s0">if </span><span class="s1">str</span><span class="s2">(</span><span class="s1">userob</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">model_pic</span><span class="s2">)</span><span class="s1">: 
                    </span><span class="s0">if </span><span class="s1">str</span><span class="s2">(</span><span class="s1">userob</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">model_pic</span><span class="s2">) </span><span class="s1">!= </span><span class="s4">'pic_folder/None/no-img.jpg'</span><span class="s1">: 
                        value = str</span><span class="s2">(</span><span class="s1">userob</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">model_pic</span><span class="s2">)[</span><span class="s5">14</span><span class="s1">:</span><span class="s2">]</span><span class="s1"> 
            request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'model_pic'</span><span class="s2">] </span><span class="s1">= value 
            request</span><span class="s2">.</span><span class="s1">session</span><span class="s2">[</span><span class="s4">'userob'</span><span class="s2">] </span><span class="s1">= serializers</span><span class="s2">.</span><span class="s1">serialize</span><span class="s2">(</span><span class="s4">'json'</span><span class="s1">, userob</span><span class="s2">)</span><span class="s1"> 
 
 
            </span><span class="s0">return </span><span class="s1">HttpResponseRedirect</span><span class="s2">(</span><span class="s4">'http://127.0.0.1:8000/libapp/'</span><span class="s2">)</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">user </span><span class="s0">is None</span><span class="s1">: 
            </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/login.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'notlogin'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
        </span><span class="s0">else</span><span class="s1">: 
            </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/login.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'notactive'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">, </span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
    </span><span class="s0">else</span><span class="s1">: 
        </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/login.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'form'</span><span class="s1">: form</span><span class="s2">})</span><span class="s1"> 
 
@login_required 
</span><span class="s0">def </span><span class="s1">user_logout</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    logout</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s3"># return HttpResponseRedirect(reverse(('libapp:index')))</span><span class="s1"> 
    </span><span class="s0">return </span><span class="s1">HttpResponseRedirect</span><span class="s2">(</span><span class="s4">'http://127.0.0.1:8000/libapp/'</span><span class="s2">)</span><span class="s1"> 
 
</span><span class="s0">from </span><span class="s1">django</span><span class="s2">.</span><span class="s1">contrib</span><span class="s2">.</span><span class="s1">auth</span><span class="s2">.</span><span class="s1">hashers </span><span class="s0">import </span><span class="s1">make_password 
 
</span><span class="s0">def </span><span class="s1">register</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    libuser = Libuser</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">all</span><span class="s2">()</span><span class="s1"> 
    </span><span class="s0">if </span><span class="s1">request</span><span class="s2">.</span><span class="s1">method == </span><span class="s4">'POST'</span><span class="s1">: 
        form = LibuserForm</span><span class="s2">(</span><span class="s1">request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">)</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">form</span><span class="s2">.</span><span class="s1">is_valid</span><span class="s2">()</span><span class="s1">: 
            libuser = form</span><span class="s2">.</span><span class="s1">save</span><span class="s2">(</span><span class="s1">commit=</span><span class="s0">False</span><span class="s2">)</span><span class="s1"> 
            libuser</span><span class="s2">.</span><span class="s1">num_interested = </span><span class="s5">1</span><span class="s1"> 
            libuser</span><span class="s2">.</span><span class="s1">password = make_password</span><span class="s2">(</span><span class="s1">form</span><span class="s2">.</span><span class="s1">cleaned_data</span><span class="s2">[</span><span class="s4">'password'</span><span class="s2">])</span><span class="s1"> 
            libuser</span><span class="s2">.</span><span class="s1">save</span><span class="s2">()</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s1">HttpResponseRedirect</span><span class="s2">(</span><span class="s4">'http://127.0.0.1:8000/libapp/login/'</span><span class="s2">)</span><span class="s1"> 
        </span><span class="s0">else</span><span class="s1">: 
            </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/register.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'form'</span><span class="s1">:form</span><span class="s2">})</span><span class="s1"> 
    </span><span class="s0">else</span><span class="s1">: 
        form = LibuserForm</span><span class="s2">()</span><span class="s1"> 
        </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/register.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'form'</span><span class="s1">:form</span><span class="s2">})</span><span class="s1"> 
 
</span><span class="s0">def </span><span class="s1">newitem</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    suggestions = Suggestion</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">all</span><span class="s2">()</span><span class="s1"> 
    </span><span class="s0">if </span><span class="s1">request</span><span class="s2">.</span><span class="s1">method == </span><span class="s4">'POST'</span><span class="s1">: 
        form = SuggestionForm</span><span class="s2">(</span><span class="s1">request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">)</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">form</span><span class="s2">.</span><span class="s1">is_valid</span><span class="s2">()</span><span class="s1">: 
            suggestion = form</span><span class="s2">.</span><span class="s1">save</span><span class="s2">(</span><span class="s1">commit=</span><span class="s0">False</span><span class="s2">)</span><span class="s1"> 
            suggestion</span><span class="s2">.</span><span class="s1">num_interested = </span><span class="s5">1</span><span class="s1"> 
            suggestion</span><span class="s2">.</span><span class="s1">save</span><span class="s2">()</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s1">HttpResponseRedirect</span><span class="s2">(</span><span class="s4">'/libapp/suggestions/'</span><span class="s2">)</span><span class="s1"> 
        </span><span class="s0">else</span><span class="s1">: 
            </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/newitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'form'</span><span class="s1">:form, </span><span class="s4">'suggestions'</span><span class="s1">:suggestions</span><span class="s2">})</span><span class="s1"> 
    </span><span class="s0">else</span><span class="s1">: 
        form = SuggestionForm</span><span class="s2">()</span><span class="s1"> 
        </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/newitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'form'</span><span class="s1">:form, </span><span class="s4">'suggestions'</span><span class="s1">:suggestions</span><span class="s2">})</span><span class="s1"> 
 
</span><span class="s0">def </span><span class="s1">myacct</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    userob = Libuser</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">id=request</span><span class="s2">.</span><span class="s1">user</span><span class="s2">.</span><span class="s1">id</span><span class="s2">)</span><span class="s1"> 
    d = </span><span class="s2">{</span><span class="s4">'first_name'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">first_name, </span><span class="s4">'last_name'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">last_name, </span><span class="s4">'emailid'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">email, 
         </span><span class="s4">'address'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">address, </span><span class="s4">'city'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">city, </span><span class="s4">'province'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">province, </span><span class="s4">'phone'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">phone</span><span class="s2">}</span><span class="s1"> 
    </span><span class="s0">if </span><span class="s1">request</span><span class="s2">.</span><span class="s1">method == </span><span class="s4">'POST'</span><span class="s1">: 
        userob = Libuser</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">id=request</span><span class="s2">.</span><span class="s1">user</span><span class="s2">.</span><span class="s1">id</span><span class="s2">).</span><span class="s1">update</span><span class="s2">(</span><span class="s1"> 
            first_name=request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'first_name'</span><span class="s2">]</span><span class="s1">, 
            last_name=request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'last_name'</span><span class="s2">]</span><span class="s1">, 
            email=request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'emailid'</span><span class="s2">]</span><span class="s1">, 
            address=request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'address'</span><span class="s2">]</span><span class="s1">, 
            city=request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'city'</span><span class="s2">]</span><span class="s1">, 
            province=request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'province'</span><span class="s2">]</span><span class="s1">, 
            phone=request</span><span class="s2">.</span><span class="s1">POST</span><span class="s2">[</span><span class="s4">'phone'</span><span class="s2">]</span><span class="s1"> 
        </span><span class="s2">)</span><span class="s1"> 
        userob = Libuser</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">id=request</span><span class="s2">.</span><span class="s1">user</span><span class="s2">.</span><span class="s1">id</span><span class="s2">)</span><span class="s1"> 
        d = </span><span class="s2">{</span><span class="s4">'first_name'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">first_name, </span><span class="s4">'last_name'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">last_name, </span><span class="s4">'emailid'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">email, 
             </span><span class="s4">'address'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">address, </span><span class="s4">'city'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">city, </span><span class="s4">'privince'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">province, </span><span class="s4">'phone'</span><span class="s1">: userob</span><span class="s2">.</span><span class="s1">phone</span><span class="s2">}</span><span class="s1"> 
        d1 = </span><span class="s4">'True'</span><span class="s1"> 
        </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/myacct.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">&quot;values&quot;</span><span class="s1">: d, </span><span class="s4">&quot;record_added&quot;</span><span class="s1">: d1</span><span class="s2">})</span><span class="s1"> 
    </span><span class="s0">else</span><span class="s1">: 
        </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/myacct.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">&quot;values&quot;</span><span class="s1">: d</span><span class="s2">})</span><span class="s1"> 
 
</span><span class="s0">def </span><span class="s1">myitems</span><span class="s2">(</span><span class="s1">request</span><span class="s2">)</span><span class="s1">: 
    itemob = Libitem</span><span class="s2">.</span><span class="s1">objects</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">user__username=request</span><span class="s2">.</span><span class="s1">user</span><span class="s2">.</span><span class="s1">username, checked_out=</span><span class="s0">True</span><span class="s2">)</span><span class="s1"> 
    </span><span class="s0">return </span><span class="s1">render</span><span class="s2">(</span><span class="s1">request, </span><span class="s4">'libapp/myitem.html'</span><span class="s1">, </span><span class="s2">{</span><span class="s4">'itemob'</span><span class="s1">: itemob</span><span class="s2">})</span><span class="s1"> 
</span></pre>
</body>
</html>